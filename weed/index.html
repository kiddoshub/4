<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Grateful Dead SF 2025 • Live Edition</title>

<!-- Plugins & Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.52/Tone.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Russo+One&display=swap" rel="stylesheet">

<style>
  body,html { margin:0; padding:0; overflow:hidden; background:#000; }
  canvas { position:absolute; top:0; left:0; width:100%; height:100%; }
  #overlay {
    position:absolute; top:5%; width:100%; text-align:center;
    pointer-events:none; mix-blend-mode:lighten; z-index:10;
  }
  .title { font-family:'Russo One',sans-serif; font-size:4vw; color:#39ff14; text-shadow:0 0 12px #39ff14; }
  .countdown { font-family:'Orbitron',sans-serif; font-size:6vw; color:#00ffff; margin-top:1vw; text-shadow:0 0 14px #00ffff; }
  .artist { font-family:'Orbitron',sans-serif; font-size:3vw; color:#ff66cc; margin-top:2vw; text-shadow:0 0 8px #ff66cc; }
</style>
</head>
<body>

<div id="overlay">
  <div class="title">GRATEFUL DEAD SF 2025</div>
  <div class="countdown" id="countdown">000d 00h 00m 00s</div>
  <div class="artist" id="artist">Loading‑…</div>
</div>
<canvas id="matrixCanvas"></canvas>

<script>
(async function(){
  const eventDate = new Date('2025-08-01T16:00:00Z');
  const artists = [
    [new Date('2025-08-01'), "Billy Strings"],
    [new Date('2025-08-02'), "Johnny Blue Skies"],
    [new Date('2025-08-03'), "Trey Anastasio Band"]
  ];

  // THREE.JS Setup
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 2000);
  camera.position.set(0,2,10);
  const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  // Environment: Skybox + Ground Plane
  const loader = new THREE.TextureLoader();
  const sky = await loader.loadAsync('haight_street_panorama.jpg');
  const rt = new THREE.WebGLCubeRenderTarget(sky.image.height);
  rt.fromEquirectangularTexture(renderer, sky);
  scene.background = rt.texture;

  const groundMat = new THREE.MeshStandardMaterial({ color:0x333322, flatShading:true });
  const ground = new THREE.Mesh(new THREE.PlaneGeometry(50,50,200,200), groundMat);
  ground.rotation.x = -Math.PI/2;
  scene.add(ground);

  const light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(10,10,5);
  scene.add(light);

  // GSAP Ground Vertex Noise Animation
  const simplex = new SimplexNoise();
  gsap.ticker.add(() => {
    const verts = ground.geometry.attributes.position.array;
    const t = Date.now()/1000;
    for(let i=0; i<verts.length; i+=3){
      verts[i+1] = simplex.noise3D(verts[i]/5, verts[i+2]/5, t)*0.3;
    }
    ground.geometry.attributes.position.needsUpdate = true;
  });

  // Audio analyzer setup
  await Tone.start();
  const mic = new Tone.UserMedia().open();
  const fft = new Tone.FFT(32);
  mic.connect(fft);

  // Matrix Canvas overlay
  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  const fontSize = 20;
  const cols = Math.floor(innerWidth/fontSize);
  const drops = Array(cols).fill(1);
  const charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

  // Orbital points
  const orbs = [];
  for(let i=0;i<120;i++){
    const orb = {
      angle:Math.random()*Math.PI*2,
      baseR:2+Math.random()*8,
      r:0,
      speed:0.001+Math.random()*0.002,
      hue:Math.random()*360
    };
    orbs.push(orb);
    gsap.to(orb, { r:orb.baseR+2, duration:2+Math.random()*2, yoyo:true, repeat:-1, ease:"sine.inOut" });
  }

  // Animate everything
  gsap.ticker.add(()=>{
    renderer.render(scene, camera);
    ctx.fillStyle = 'rgba(0,0,0,0.08)';
    ctx.fillRect(0,0,innerWidth,innerHeight);

    const now = Date.now();
    const spectrum = fft.getValue().map(v=>Math.pow(10,v/10));

    orbs.forEach((o,i)=>{
      o.angle += o.speed + spectrum[i%32]*0.02;
      const x = innerWidth/2 + o.r * Math.cos(o.angle),
            y = innerHeight/2 + o.r * Math.sin(o.angle);
      ctx.fillStyle = `hsl(${(now/50+o.hue)%360},100%,60%)`;
      ctx.beginPath(); ctx.arc(x,y,1.5,0,2*Math.PI); ctx.fill();
    });

    drops.forEach((_,i) => {
      const x = i*fontSize, y=drops[i]*fontSize;
      const hue = (now/80 + i*5) % 360;
      ctx.fillStyle = `hsl(${hue},90%,50%)`;
      ctx.font = `${fontSize}px Orbitron`;
      ctx.fillText(charset.charAt(Math.floor(Math.random()*charset.length)), x, y);
      drops[i] = y>innerHeight && Math.random()>0.975 ? 0 : drops[i]+1;
    });
  });

  // Camera slow orbit
  gsap.to(camera.position, { x:10, z:10, duration:60, yoyo:true, repeat:-1, ease:"sine.inOut" });
  gsap.to(camera, { rotation: { y:Math.PI*2 }, duration:120, repeat:-1, ease:"linear" });

  // Countdown & Artist
  const cd = document.getElementById('countdown');
  const artEl = document.getElementById('artist');
  const fmt2 = v => String(v).padStart(2,'0');

  function refresh(){
    const now=new Date(), diff=eventDate-now;
    const d=fmt2(Math.max(0,Math.floor(diff/864e5))),
          h=fmt2(Math.floor(diff%864e5/36e5)),
          m=fmt2(Math.floor(diff%36e5/6e4)),
          s=fmt2(Math.floor(diff%6e4/1e3));
    cd.textContent = `${d}d ${h}h ${m}m ${s}s`;

    let art = 'Stay Tuned';
    for(let [dt,n] of artists){
      if(now < dt) { art = n; break; }
    }
    artEl.textContent = `NEXT: ${art}`;
  }
  setInterval(refresh,200);
  refresh();

  window.addEventListener('resize', ()=>{
    renderer.setSize(innerWidth,innerHeight);
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    canvas.width = innerWidth;
    canvas.height = innerHeight;
  });
})();
</script>

</body>
</html>